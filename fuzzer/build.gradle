plugins {
    id 'java'
    id 'application'
}

group 'fuzzer'
version '0.0.1'

sourceCompatibility = 1.8

repositories {
    mavenCentral()
    maven { url 'https://jitpack.io' }
    flatDir {
       dirs 'libs'
   }
}

mainClassName = 'Experimental.TestGeneration'

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.12'
    compile 'com.squareup:javapoet:1.11.1'
    compile name: 'grpc_server_bundle'
    compile name: 'commons-math3-3.6.1'
//    compile name: 'agent-0.1.0'
//    compile name: 'fuzz-0.1.0'
//    compile name: 'extras-0.1.0'
    compile 'com.github.ggavriil:javan-warty-pig:gg-test-writer-SNAPSHOT'
//    compile 'com.github.Chrisbattarbee:javan-warty-pig:cb-testing-SNAPSHOT'
    compile group: 'org.json', name: 'json', version: '20180813'
}

run.doFirst {
    // Get the full path of the agent JAR and set the javaagent
    def agentPath = configurations.compile.find { it.absolutePath.contains 'agent' }.absolutePath
    jvmArgs "-javaagent:$agentPath"
}

jar {
    manifest {
        attributes  'Implementation-Title': 'Gradle Quickstart',
                    'Implementation-Version': version,
                    'Main-Class': 'Experimental.TestGeneration'
    }
}


//create a single Jar with all dependencies
task fatJar(type: Jar) {
    manifest {
        attributes 'Implementation-Title': 'Gradle Jar File Example',
                'Implementation-Version': version,
                'Main-Class': 'Experimental.TestGeneration'
    }
    archiveName = "fuzzer-bigboi.jar"
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
}
